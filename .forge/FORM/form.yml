name: Minecraft Server Deployment Request
description: Request a new Minecraft Fabric server deployment with custom configuration
body:
  - type: input
    id: server_name
    attributes:
      label: Server Name
      description: A unique name for your Minecraft server
      placeholder: my-minecraft-server
      input_type: text
    validations:
      required: true
      min_length: 3
      max_length: 50
      pattern: "^[a-z0-9-]+$"
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: null
      computed: false
      script: null
      script_params: {}

  - type: input
    id: requester_email
    attributes:
      label: Requester Email
      description: Email address for deployment notifications
      placeholder: user@example.com
      input_type: email
    validations:
      required: true
      pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: null
      computed: false
      script: null
      script_params: {}

  - type: dropdown
    id: server_version
    attributes:
      label: Minecraft Version
      description: Select the Minecraft version for your server
      options:
        - value: "1.21.1"
          label: "1.21.1 (Latest)"
        - value: "1.21"
          label: "1.21"
        - value: "1.20.6"
          label: "1.20.6"
        - value: "1.20.4"
          label: "1.20.4"
        - value: "1.20.1"
          label: "1.20.1"
      default: "1.21.1"
      multiple: false
    validations:
      required: true
    visibility:
      condition: null
      depends_on: []
    dynamic:
      options_source: null
      filter_by: null
      computed: false
      script: null
      script_params: {}

  - type: input
    id: memory_min
    attributes:
      label: Minimum Memory (GB)
      description: Minimum heap size for the JVM (in GB)
      placeholder: "2"
      input_type: number
      default: "2"
    validations:
      required: false
      min: 1
      max: 32
      step: 1
    visibility:
      condition: "memory_allocation == 'custom'"
      depends_on: ["memory_allocation"]
    dynamic:
      auto_populate: "2"
      computed: false
      script: null
      script_params: {}

  - type: input
    id: memory_max
    attributes:
      label: Maximum Memory (GB)
      description: Maximum heap size for the JVM (in GB)
      placeholder: "4"
      input_type: number
      default: "4"
    validations:
      required: false
      min: 1
      max: 32
      step: 1
    visibility:
      condition: "memory_allocation == 'custom'"
      depends_on: ["memory_allocation"]
    dynamic:
      auto_populate: "4"
      computed: false
      script: null
      script_params: {}

  - type: input
    id: server_port
    attributes:
      label: Server Port
      description: Port number for the Minecraft server (default 25565)
      placeholder: "25565"
      input_type: number
      default: "25565"
    validations:
      required: false
      min: 1024
      max: 65535
      step: 1
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: "25565"
      computed: false
      script: null
      script_params: {}

  - type: dropdown
    id: game_mode
    attributes:
      label: Game Mode
      description: Default game mode for the server
      options:
        - value: survival
          label: Survival
        - value: creative
          label: Creative
        - value: adventure
          label: Adventure
        - value: spectator
          label: Spectator
      default: survival
      multiple: false
    validations:
      required: true
    visibility:
      condition: null
      depends_on: []
    dynamic:
      options_source: null
      filter_by: null
      computed: false
      script: null
      script_params: {}

  - type: dropdown
    id: difficulty
    attributes:
      label: Difficulty
      description: Game difficulty level
      options:
        - value: peaceful
          label: Peaceful
        - value: easy
          label: Easy
        - value: normal
          label: Normal
        - value: hard
          label: Hard
      default: normal
      multiple: false
    validations:
      required: true
    visibility:
      condition: null
      depends_on: []
    dynamic:
      options_source: null
      filter_by: null
      computed: false
      script: null
      script_params: {}

  - type: input
    id: max_players
    attributes:
      label: Maximum Players
      description: Maximum number of players allowed on the server
      placeholder: "20"
      input_type: number
      default: "20"
    validations:
      required: false
      min: 1
      max: 1000
      step: 1
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: "20"
      computed: false
      script: null
      script_params: {}

  - type: input
    id: world_seed
    attributes:
      label: World Seed (Optional)
      description: Enter a custom seed for world generation (leave blank for random)
      placeholder: "Leave blank for random generation"
      input_type: text
      default: ""
    validations:
      required: false
      min_length: null
      max_length: null
      pattern: null
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: ""
      computed: false
      script: null
      script_params: {}

  - type: input
    id: world_name
    attributes:
      label: World Name
      description: Name for the world directory
      placeholder: "world"
      input_type: text
    validations:
      required: false
      min_length: null
      max_length: 50
      pattern: null
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: "world"
      computed: false
      script: null
      script_params: {}

  - type: dropdown
    id: world_type
    attributes:
      label: World Type
      description: Type of world to generate
      options:
        - value: default
          label: Default
        - value: flat
          label: Superflat
        - value: large_biomes
          label: Large Biomes
        - value: amplified
          label: Amplified
      default: default
      multiple: false
    validations:
      required: false
    visibility:
      condition: null
      depends_on: []
    dynamic:
      options_source: null
      filter_by: null
      computed: false
      script: null
      script_params: {}

  - type: checkboxes
    id: server_options
    attributes:
      label: Server Options
      description: Select additional server configuration options
      default: ["pvp", "generate_structures", "spawn_protection", "whitelist"]
      options:
        - value: online_mode
          label: Online Mode (Authenticate with Mojang servers)
          required: false
        - value: pvp
          label: Enable PvP
          required: false
        - value: whitelist
          label: Enable Whitelist
          required: false
        - value: command_blocks
          label: Enable Command Blocks
          required: false
        - value: spawn_protection
          label: Enable Spawn Protection
          required: false
        - value: generate_structures
          label: Generate Structures (villages, temples, etc.)
          required: false
    validations:
      required: false
      min_selections: null
      max_selections: null
    visibility:
      condition: null
      depends_on: []
    dynamic:
      options_source: null
      computed: false
      script: null
      script_params: {}

  - type: textarea
    id: whitelist_players
    attributes:
      label: Whitelist Players
      description: Enter player usernames (one per line) to add to the whitelist
      placeholder: "player1\nplayer2\nplayer3"
      rows: 5
      cols: 50
      render: text
      default: ""
    validations:
      required: false
      min_length: null
      max_length: null
    visibility:
      condition: "server_options.includes('whitelist')"
      depends_on: ["server_options"]
    dynamic:
      auto_populate: ""
      computed: false
      script: null
      script_params: {}

  - type: textarea
    id: op_players
    attributes:
      label: Operator Players
      description: Enter player usernames (one per line) to grant operator status
      placeholder: "admin1\nadmin2"
      rows: 3
      cols: 50
      render: text
      default: ""
    validations:
      required: false
      min_length: null
      max_length: null
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: ""
      computed: false
      script: null
      script_params: {}

  - type: textarea
    id: motd
    attributes:
      label: Server MOTD (Message of the Day)
      description: The message displayed in the server list
      placeholder: "A Minecraft Server"
      rows: 2
      cols: 50
      render: text
    validations:
      required: false
      min_length: null
      max_length: 100
    visibility:
      condition: null
      depends_on: []
    dynamic:
      auto_populate: "A Minecraft Server"
      computed: false
      script: null
      script_params: {}

  # ========== AUTO-POPULATE TEST FIELDS ==========

  # 1. TEMPLATE STRING - Client-side, instant
  - type: input
    id: server_identifier
    attributes:
      label: Server Identifier
      description: Auto-generated from server name and version
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate: "{server_name}-{server_version}"
      computed: true
      depends_on: ["server_name", "server_version"]

  # 2. DATE KEYWORD - Client-side
  - type: input
    id: deployment_date
    attributes:
      label: Deployment Date
      description: Auto-populated with today's date
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate: "today"
      computed: true

  # 3. BUILT-IN FUNCTION - concat
  - type: input
    id: full_address
    attributes:
      label: Full Server Address
      description: Combined server name and port (builtin concat)
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: builtin
        function: concat
        params:
          values: ["{server_name}", ":", "{server_port}"]
      computed: true
      depends_on: ["server_name", "server_port"]

  # 3b. BUILT-IN FUNCTION - uppercase
  - type: input
    id: server_name_upper
    attributes:
      label: Server Name (Uppercase)
      description: Server name converted to uppercase (builtin uppercase)
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: builtin
        function: uppercase
        params:
          field: "{server_name}"
      computed: true
      depends_on: ["server_name"]

  # 3c. BUILT-IN FUNCTION - lowercase
  - type: input
    id: game_mode_lower
    attributes:
      label: Game Mode (Lowercase)
      description: Game mode converted to lowercase (builtin lowercase)
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: builtin
        function: lowercase
        params:
          field: "{game_mode}"
      computed: true
      depends_on: ["game_mode"]

  # 3d. BUILT-IN FUNCTION - sum
  - type: input
    id: total_memory
    attributes:
      label: Total Memory (Min + Max)
      description: Sum of min and max memory values (builtin sum)
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: builtin
        function: sum
        params:
          values: ["{memory_min}", "{memory_max}"]
      computed: true
      depends_on: ["memory_min", "memory_max"]

  # 3e. BUILT-IN FUNCTION - multiply
  - type: input
    id: player_capacity
    attributes:
      label: Player Capacity Score
      description: Max players multiplied by 10 (builtin multiply)
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: builtin
        function: multiply
        params:
          values: ["{max_players}", 10]
      computed: true
      depends_on: ["max_players"]

  # 4. INLINE PYTHON SCRIPT - Server-side via executor
  - type: input
    id: estimated_cost
    attributes:
      label: Estimated Monthly Cost ($)
      description: Calculated based on memory allocation and players
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: inline
        language: python
        source: |
          def calculate(form_data, params):
              memory = form_data.get('memory_allocation', '2G')
              rates = {'1G': 5, '2G': 10, '4G': 20, '8G': 40, 'custom': 30}
              cost = rates.get(memory, 10)
              players = int(form_data.get('max_players', 20))
              return f"{cost + (players * 0.1):.2f}"
        params: {}
      computed: true
      depends_on: ["memory_allocation", "max_players"]

  # 5. INLINE JAVASCRIPT SCRIPT - Server-side via executor
  - type: input
    id: player_density
    attributes:
      label: Player Density
      description: Players per GB of RAM
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: inline
        language: javascript
        source: |
          function calculate(formData, params) {
              const memory = formData.memory_allocation || '2G';
              const memoryGB = parseInt(memory) || 2;
              const players = parseInt(formData.max_players) || 20;
              return (players / memoryGB).toFixed(1) + ' players/GB';
          }
        params: {}
      computed: true
      depends_on: ["memory_allocation", "max_players"]
  # 6. INLINE BASH SCRIPT - Server-side via executor
  - type: input
    id: jvm_flags
    attributes:
      label: JVM Flags Preview
      description: Generated JVM memory flags
      input_type: text
    validations:
      required: false
    dynamic:
      auto_populate:
        type: inline
        language: bash
        source: |
          mem_min=$(echo "$FORM_DATA" | python3 -c "import sys,json; d=json.load(sys.stdin); print(d.get('memory_min') or '2')")
          mem_max=$(echo "$FORM_DATA" | python3 -c "import sys,json; d=json.load(sys.stdin); print(d.get('memory_max') or '4')")
          echo "-Xms${mem_min}G -Xmx${mem_max}G"
        params: {}
      computed: true
      depends_on: ["memory_min", "memory_max"]